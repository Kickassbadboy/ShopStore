<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>JsStorage Example</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link href="../materialize/css/materialize.min.css" rel="stylesheet " type="text/css" />
    <script src="../Scripts/jquery.js"></script>
    <script src="../materialize/js/materialize.min.js"></script>
    <link href="../Style/common.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <ul id="listCustomer" class="dropdown-content">
        <li><a href="../customer/add.html">Add</a></li>
        <li><a href="../customer/index.html">List</a></li>
    </ul>
    <ul id="listStock" class="dropdown-content">
        <li><a href="../stock/add.html">Add</a></li>
        <li><a href="../stock/index.html">List</a></li>
    </ul>
    <nav class="nav-extended">
        <div class="nav-wrapper">
            <ul id="nav-mobile" class="right">
                <li><a href="../index.html">Home</a></li>
                <li class="active"><a class="dropdown-button" href="#!" data-activates="listCustomer">Customer<i class="material-icons right">arrow_drop_down</i></a></li>
                <li><a class="dropdown-button" href="#!" data-activates="listStock">Stock<i class="material-icons right">arrow_drop_down</i></a></li>
            </ul>
            <div class="brand-logo center-align">
                <a href="#" title="Download MatDialog" class="logo">ShopDemo</a><br>
            </div>
        </div>
    </nav>
    <div class="row">
        <form class="col s12 m8 l6 xl4 push-s0 push-m2 push-l3 push-xl4 right-alert">
            <h5 class="#bf360c deep-orange darken-4 color-white padding-10-px center-align">Add Items In Store</h5>
            <div class="input-field col s12">
                <input id="txtName" type="text" class="validate">
                <label for="txtName" data-error="wrong" data-success="right">Customer Name</label>
            </div>
            <div class="input-field col s12">
                <input id="txtDob" type="text" class="datepicker validate">
                <label for="txtDob" data-error="wrong" data-success="right">Date Of Birth</label>
            </div>
            <div class="input-field col s12">
                <input id="txtEmail" type="text" class="validate">
                <label for="txtEmail" data-error="wrong" data-success="right">Email Id</label>
            </div>
            <div class="center-align">
                <a class="waves-effect waves-light btn" onclick="save();"><i class="material-icons left">done</i>Add</a>
                <a class="waves-effect waves-light btn"><i class="material-icons left">close</i>Cancel</a>
            </div>
        </form>
    </div>
    <script src="../Scripts/matdialog.min-1.0.0.js"></script>
    <link href="../Style/matdialog.min-1.0.0.css" rel="stylesheet" type="text/css" />
    <script src="../Scripts/JsValidator.js"></script>
    <script src="../Scripts/JsStore-1.0.2.js"></script>
    <script src="../Scripts/DbStructure.js"></script>
    <script src="../Scripts/common.js"></script>
    <script>
        var Validator;
        onPageLoaded = function () {
            Validator = new JsValidator();
            $('.datepicker').pickadate({
                selectMonths: true, // Creates a dropdown to control month
                selectYears: 100 // Creates a dropdown of 15 years to control year
            });
            var Email = getQsValueByName('email');
            if (Email != null) {
                $('#txtEmail').focus().val(Email);
            }
        }

        function save() {
            var ECustomerName = $('#txtName'),
                ECustomerDob = $('#txtDob'),
                ECustomerEmail = $('#txtEmail');
            Validator.startValidation();
            if (Validator.isInvalid(ECustomerName.val())) {
                ECustomerName.addClass('invalid').next().attr('data-error', Validator.ErrMsg);
            }
            if (Validator.isInvalid(ECustomerDob.val())) {
                ECustomerDob.addClass('invalid').next().attr('data-error', Validator.ErrMsg);
            }
            if (Validator.isInvalid(ECustomerEmail.val(), {
                    Type: 'email'
                })) {
                ECustomerEmail.addClass('invalid').next().attr('data-error', Validator.ErrMsg);
            }
            if (!Validator.IsAnyError) {
                var Value = {
                    CustomerName: ECustomerName.val(),
                    Email: ECustomerEmail.val(),
                    Dob: ECustomerDob.val()
                };
                Db.DbConnection.insert({
                    Into: "Customer",
                    Values: [Value]
                }, function (rowsCount) {
                    if (rowsCount > 0) {
                        DialogBox.alert('Successfully Added');
                        if (getQsValueByName('email') != null) {
                            window.location.href = "../index.html?email=" + ECustomerEmail.val();
                        }
                        $('form')[0].reset();
                    }
                }, function (error) {
                    if (error) {
                        DialogBox.alert('Error Occured');
                    }
                    console.log(error);
                })
            }
        }
    </script>
</body>

</html>